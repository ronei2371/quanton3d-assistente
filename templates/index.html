<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>IA Quanton3DÂ® â€” Suporte TÃ©cnico 3D</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='site.css') }}?v=7">
</head>
<body>
  <!-- BotÃ£o de candidatura -->
  <p style="text-align:right;margin:6px 0 0">
    <a class="btn btn-secondary" href="/apply">âš¡ Como se candidatar</a>
  </p>

  <div class="container">
    <h1>IA Quanton3DÂ® â€” Suporte TÃ©cnico 3D</h1>

    <form id="diagnostico-form">
      <label>Telefone (sempre o mesmo)</label>
      <input type="tel" name="telefone" placeholder="Ex.: 5531999999999" required>

      <label>Descreva seu problema</label>
      <textarea name="problema" rows="4" placeholder="Ex.: delaminaÃ§Ã£o, base grudada, manchas..." required></textarea>

      <div style="display:flex;gap:10px;margin-top:10px;">
        <button type="submit" class="btn btn-primary">Enviar</button>
        <button type="reset" class="btn btn-secondary">Limpar</button>
      </div>
    </form>

    <h2 style="margin-top:20px;">Respostas</h2>
    <div id="respostas" class="responses" style="min-height:160px;padding:12px;"></div>
  </div>

  <!-- Overlay de Termos -->
  <div id="overlay-termos" class="overlay" style="display:none;">
    <div class="modal">
      <h2>ðŸ“Œ Termo de Uso â€“ Bot Quanton3DÂ®</h2>
      <p>Ao continuar, vocÃª declara que:</p>
      <ul>
        <li>Reconhece que o bot Ã© propriedade exclusiva da Quanton3D;</li>
        <li>O uso Ã© permitido apenas para suporte em impressÃ£o 3D;</li>
        <li>Ã‰ proibida a cÃ³pia, modificaÃ§Ã£o ou redistribuiÃ§Ã£o;</li>
        <li>As respostas sÃ£o apoio tÃ©cnico e nÃ£o substituem decisÃµes profissionais;</li>
        <li>ViolaÃ§Ã£o implica bloqueio de acesso e medidas legais.</li>
      </ul>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-primary" id="btn-aceito">âœ… Aceito e Continuar</button>
        <button class="btn btn-secondary" id="btn-contrato">ðŸ“„ Ver contrato completo</button>
        <a class="btn btn-secondary" href="/apply">âš¡ Como se candidatar</a>
      </div>
      <pre id="contrato" class="contrato" style="display:none;"></pre>
    </div>
  </div>

<script>
// Gate de termos v7
(function() {
  const KEY = 'q3d_terms_v7';
  const accepted = localStorage.getItem(KEY) === 'true';
  const overlay = document.getElementById('overlay-termos');
  if (!accepted) {
    overlay.style.display = 'grid';
  }
  document.getElementById('btn-aceito').onclick = function() {
    localStorage.setItem(KEY, 'true');
    overlay.style.display = 'none';
  };
  document.getElementById('btn-contrato').onclick = async function() {
    const el = document.getElementById('contrato');
    if (el.style.display === 'block') { el.style.display = 'none'; return; }
    try {
      const r = await fetch('/static/contrato.txt?v=7');
      el.textContent = await r.text();
    } catch(e) {
      el.textContent = 'Contrato nÃ£o encontrado. Crie static/contrato.txt';
    }
    el.style.display = 'block';
  };
})();

// Envio do formulÃ¡rio para POST /chat
const form = document.getElementById('diagnostico-form');
const box  = document.getElementById('respostas');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const phone   = form.telefone.value.trim();
  const problem = form.problema.value.trim();
  box.textContent = 'Enviando...';
  try {
    const resp = await fetch('/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ phone, problem, persona: 'caio' })
    });
    const data = await resp.json();
    box.textContent = (data.answer || data.error || 'Sem resposta');
  } catch (err) {
    box.textContent = 'Erro ao enviar: ' + err;
  }
});
</script>
</body>
</html>
